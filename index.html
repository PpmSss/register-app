<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 40px;
            height: 100vh;
            margin: 0;
            background: linear-gradient(to bottom, #ffffff 0%, #eeeeee 50%, #dddddd 80%, #cccccc 100%);
            background-repeat: no-repeat;
            /* üõë ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô repeat */
            background-attachment: fixed;
            /* ‚úÖ ‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡∏ï‡∏¥‡∏î‡∏û‡∏∑‡πâ‡∏ô */
        }
        
        input {
            text-align: center;
            padding: 20px;
            font-size: 40px;
            width: 400px;
        }
        
        button {
            padding: 15px 20px;
            font-size: 18px;
        }
        
        #status {
            margin-top: 20px;
            min-height: 90px;
            font-size: 30px;
            font-weight: bold;
        }
        
        .form-group {
            margin: 30px 0;
        }
        
        .bottom-image {
            margin-top: 10px;
            max-width: 35%;
            height: auto;
        }
        
        .bottom-image2 {
            margin-top: 10px;
            margin-right: 10px;
            max-width: 300px;
            height: auto;
        }
    </style>
</head>

<body>
    <h1>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h1>
    <div class="form-group">
        <input type="text" id="studentId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Student ID">
    </div>
    <div class="form-group">
        <button onclick="submitId()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
    </div>
    <div id="status"></div>
    <div class="form-group">
        <img src="mecha.png" alt="logo" class="bottom-image2">
        <img src="automotive.png" alt="logo" class="bottom-image2">
    </div>
    <div class="form-group">
        <img src="SUT_Engineering_Th.png" alt="logo" class="bottom-image">
    </div>



    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDteqEJH-VOPTk1PlATSAHHFLOfREEVgn4",
            authDomain: "mexregister-9a132.firebaseapp.com",
            databaseURL: "https://mexregister-9a132-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "mexregister-9a132",
            storageBucket: "mexregister-9a132.firebasestorage.app",
            messagingSenderId: "1094324636464",
            appId: "1:1094324636464:web:d0349da84d0765106116f5"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        window.onload = () => {
            const input = document.getElementById("studentId");
            input.focus();
            input.addEventListener("keyup", function(event) {
                if (event.key === "Enter") {
                    submitId();
                }
            });
        };

        function submitId() {
            const id = document.getElementById("studentId").value.trim();
            const statusDiv = document.getElementById("status");

            if (!id) {
                statusDiv.innerText = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Student ID";
                return;
            }

            statusDiv.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...";
            console.log("ID ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô Firebase:", id);

            db.ref("registrations/" + id).once("value").then(regSnap => {
                if (regSnap.exists()) {
                    const data = regSnap.val();
                    //const name = data.name || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠";
                    const name = typeof data === "string" ? data : (data.name || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠");
                    statusDiv.innerHTML = `<span style="color:orange">‚ö†Ô∏è ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß<br><strong style="display: block; text-align: center;>${name}</strong></span>`;
                    return;
                }

                db.ref("studentsList/" + id).once("value").then(snapshot => {
                    if (snapshot.exists()) {
                        const student = snapshot.val();
                        const fullName = student; // student ‡πÄ‡∏õ‡πá‡∏ô string ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏ä‡πà‡∏ô "‡∏†‡∏≤‡∏Ñ‡∏†‡∏π‡∏°‡∏¥ ‡∏™‡∏π‡πà‡πÅ‡∏™‡∏ô‡∏™‡∏∏‡∏Ç"
                        const timestamp = new Date().toISOString();

                        db.ref("registrations/" + id).set({
                            name: fullName,
                            registeredAt: timestamp
                        }).then(() => {
                            statusDiv.innerHTML = `<span style="color:green">‚úî ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à<br><strong style="display: block; text-align: center;>${fullName}</strong></span>`;
                            document.getElementById("studentId").value = "";
                            document.getElementById("studentId").focus();
                        });
                    } else {
                        statusDiv.innerHTML = `<span style="color:red">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</span>`;
                    }
                });
            }).catch(error => {
                statusDiv.innerHTML = `<span style="color:red">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</span>`;
            });
        }
    </script>

</body>

</html>
